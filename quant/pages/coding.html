<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Data Viewer</title>
    <link rel="stylesheet" href="website/stylesheet.css">
</head>
<body>
    <h1>CSV Data Viewer</h1>
    <div class="filter-container">
        <label for="difficultyFilter">Difficulty:</label>
        <select id="difficultyFilter">
            <option value="">All</option>
            <option value="Easy">Easy</option>
            <option value="Medium">Medium</option>
            <option value="Hard">Hard</option>
        </select>

        <label for="companyFilter">Company:</label>
        <select id="companyFilter">
            <option value="">All</option>
        </select>
    </div>
    <table id="dataTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        let allRows = [];

        async function fetchCSV() {
            try {
                const response = await fetch('https://shubhamcodez.github.io/website/data/Quant%20Problem%20Sheet.csv');
                const data = await response.text();
                const rows = data.split('\n').map(row => row.split(','));
                allRows = rows; // Store all rows for filtering
                return rows;
            } catch (error) {
                console.error('Error fetching CSV:', error);
                return null;
            }
        }

        function createTableFromCSV(rows) {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            tableHead.innerHTML = ''; // Clear existing head
            tableBody.innerHTML = ''; // Clear existing body

            // Create header
            const headerRow = document.createElement('tr');
            rows[0].forEach((header, index) => {
                const th = document.createElement('th');
                th.textContent = header;
                th.onclick = () => sortTable(index);
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            // Create body
            rows.slice(1).forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });

            updateCompanyFilter(rows);
        }

        function updateCompanyFilter(rows) {
            const companyFilter = document.getElementById('companyFilter');
            const companies = new Set(rows.slice(1).map(row => row[1])); // Assuming company name is in the second column
            companyFilter.innerHTML = '<option value="">All</option>'; // Reset options
            companies.forEach(company => {
                companyFilter.innerHTML += `<option value="${company}">${company}</option>`;
            });
        }

        function filterTable() {
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const companyFilter = document.getElementById('companyFilter').value;

            const filteredRows = allRows.filter((row, index) => {
                if (index === 0) return true; // Always include header
                const matchesDifficulty = difficultyFilter ? row[0] === difficultyFilter : true; // Assuming difficulty is in the first column
                const matchesCompany = companyFilter ? row[1] === companyFilter : true; // Assuming company is in the second column
                return matchesDifficulty && matchesCompany;
            });

            createTableFromCSV(filteredRows);
        }

        function sortTable(n) {
            const table = document.getElementById("dataTable");
            let switching = true;
            let dir = "asc";
            let switchcount = 0;

            while (switching) {
                switching = false;
                const rows = table.rows;

                for (let i = 1; i < (rows.length - 1); i++) {
                    let shouldSwitch = false;
                    const x = rows[i].getElementsByTagName("TD")[n];
                    const y = rows[i + 1].getElementsByTagName("TD")[n];

                    let xValue = isNaN(x.innerHTML) ? x.innerHTML.toLowerCase() : parseFloat(x.innerHTML);
                    let yValue = isNaN(y.innerHTML) ? y.innerHTML.toLowerCase() : parseFloat(y.innerHTML);

                    if (dir === "asc") {
                        if (xValue > yValue) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir === "desc") {
                        if (xValue < yValue) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount === 0 && dir === "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        // Load and display CSV data when the page loads
        window.onload = async function() {
            const csvData = await fetchCSV();
            if (csvData) {
                createTableFromCSV(csvData);
            } else {
                console.error('Failed to load CSV data');
            }

            document.getElementById('difficultyFilter').addEventListener('change', filterTable);
            document.getElementById('companyFilter').addEventListener('change', filterTable);
        };
    </script>
</body>
</html>
